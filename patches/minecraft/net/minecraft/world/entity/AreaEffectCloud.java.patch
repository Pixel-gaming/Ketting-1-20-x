--- a/net/minecraft/world/entity/AreaEffectCloud.java
+++ b/net/minecraft/world/entity/AreaEffectCloud.java
@@ -149,6 +_,18 @@
       this.f_19687_ = p_19735_;
    }
 
+   // Spigot start - copied from below
+   @Override
+   public void inactiveTick() {
+      super.inactiveTick();
+
+      if (this.f_19797_ >= this.f_19688_ + this.f_19687_) {
+         this.m_146870_();
+         return;
+      }
+   }
+   // Spigot end
+
    public void m_8119_() {
       super.m_8119_();
       boolean flag = this.m_19747_();
@@ -238,19 +_,35 @@
             } else {
                List<LivingEntity> list1 = this.m_9236_().m_45976_(LivingEntity.class, this.m_20191_());
                if (!list1.isEmpty()) {
+                  List<org.bukkit.entity.LivingEntity> entities = new java.util.ArrayList<org.bukkit.entity.LivingEntity>(); // CraftBukkit
                   for(LivingEntity livingentity : list1) {
                      if (!this.f_19686_.containsKey(livingentity) && livingentity.m_5801_()) {
                         double d8 = livingentity.m_20185_() - this.m_20185_();
                         double d1 = livingentity.m_20189_() - this.m_20189_();
                         double d3 = d8 * d8 + d1 * d1;
                         if (d3 <= (double)(f * f)) {
-                           this.f_19686_.put(livingentity, this.f_19797_ + this.f_19689_);
-
-                           for(MobEffectInstance mobeffectinstance1 : list) {
-                              if (mobeffectinstance1.m_19544_().m_8093_()) {
-                                 mobeffectinstance1.m_19544_().m_19461_(this, this.m_19749_(), livingentity, mobeffectinstance1.m_19564_(), 0.5D);
+                           // CraftBukkit start
+                           entities.add((org.bukkit.entity.LivingEntity) livingentity.getBukkitEntity());
+                        }
+                     }
+                  }
+
+                  org.bukkit.event.entity.AreaEffectCloudApplyEvent event = org.bukkit.craftbukkit.event.CraftEventFactory.callAreaEffectCloudApplyEvent(this, entities);
+                  if (!event.isCancelled()) {
+                     for (org.bukkit.entity.LivingEntity entity : event.getAffectedEntities()) {
+                        if (entity instanceof org.bukkit.craftbukkit.entity.CraftLivingEntity) {
+                           LivingEntity entityliving = ((org.bukkit.craftbukkit.entity.CraftLivingEntity) entity).getHandle();
+                           // CraftBukkit end
+                           this.f_19686_.put(entityliving, this.f_19797_ + this.f_19689_);
+                           java.util.Iterator iterator2 = list.iterator();
+
+                           while (iterator2.hasNext()) {
+                              MobEffectInstance mobeffect1 = (MobEffectInstance) iterator2.next();
+
+                              if (mobeffect1.m_19544_().m_8093_()) {
+                                 mobeffect1.m_19544_().m_19461_(this, this.m_19749_(), entityliving, mobeffect1.m_19564_(), 0.5D);
                               } else {
-                                 livingentity.m_147207_(new MobEffectInstance(mobeffectinstance1), this);
+                                 entityliving.addEffect(new MobEffectInstance(mobeffect1), this, org.bukkit.event.entity.EntityPotionEffectEvent.Cause.AREA_EFFECT_CLOUD); // CraftBukkit
                               }
                            }
 
