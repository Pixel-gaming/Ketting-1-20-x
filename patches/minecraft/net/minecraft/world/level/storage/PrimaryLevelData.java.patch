--- a/net/minecraft/world/level/storage/PrimaryLevelData.java
+++ b/net/minecraft/world/level/storage/PrimaryLevelData.java
@@ -82,6 +_,21 @@
    private boolean f_78440_;
    private final Set<String> f_276525_;
    private final TimerQueue<MinecraftServer> f_78441_;
+   private boolean confirmedExperimentalWarning = false;
+   // CraftBukkit start - Add world and pdc
+   public net.minecraft.core.Registry<net.minecraft.world.level.dimension.LevelStem> customDimensions;
+   private net.minecraft.server.level.ServerLevel world;
+   protected Tag pdc;
+
+   public void setWorld(net.minecraft.server.level.ServerLevel world) {
+      if (this.world != null) {
+         return;
+      }
+      this.world = world;
+      world.getWorld().readBukkitValues(pdc);
+      pdc = null;
+   }
+   // CraftBukkit end
 
    private PrimaryLevelData(@Nullable DataFixer p_277859_, int p_277672_, @Nullable CompoundTag p_277888_, boolean p_278109_, int p_277714_, int p_278088_, int p_278037_, float p_277542_, long p_277414_, long p_277635_, int p_277595_, int p_277794_, int p_278007_, boolean p_277943_, int p_277674_, boolean p_277644_, boolean p_277749_, boolean p_278004_, WorldBorder.Settings p_277729_, int p_277856_, int p_278051_, @Nullable UUID p_277341_, Set<String> p_277989_, Set<String> p_277399_, TimerQueue<MinecraftServer> p_277860_, @Nullable CompoundTag p_277936_, EndDragonFight.Data p_289764_, LevelSettings p_278064_, WorldOptions p_278072_, PrimaryLevelData.SpecialWorldProperty p_277548_, Lifecycle p_277915_) {
       this.f_78452_ = p_277859_;
@@ -127,7 +_,7 @@
          return p_78529_.asString().result().stream();
       }).collect(Collectors.toCollection(Sets::newLinkedHashSet)), p_78531_.get("removed_features").asStream().flatMap((p_277335_) -> {
          return p_277335_.asString().result().stream();
-      }).collect(Collectors.toSet()), new TimerQueue<>(TimerCallbacks.f_82226_, p_78531_.get("ScheduledEvents").asStream()), (CompoundTag)p_78531_.get("CustomBossEvents").orElseEmptyMap().getValue(), p_78531_.get("DragonFight").read(EndDragonFight.Data.f_289707_).resultOrPartial(f_78442_::error).orElse(EndDragonFight.Data.f_289709_), p_78535_, p_251864_, p_250651_, p_78538_);
+      }).collect(Collectors.toSet()), new TimerQueue<>(TimerCallbacks.f_82226_, p_78531_.get("ScheduledEvents").asStream()), (CompoundTag)p_78531_.get("CustomBossEvents").orElseEmptyMap().getValue(), p_78531_.get("DragonFight").read(EndDragonFight.Data.f_289707_).resultOrPartial(f_78442_::error).orElse(EndDragonFight.Data.f_289709_), p_78535_, p_251864_, p_250651_, p_78538_).withConfirmedWarning(p_78538_ != Lifecycle.stable() && p_78531_.get("confirmedExperimentalSettings").asBoolean(false));
    }
 
    public CompoundTag m_6626_(RegistryAccess p_78543_, @Nullable CompoundTag p_78544_) {
@@ -156,7 +_,7 @@
       p_78547_.m_128365_("Version", compoundtag);
       NbtUtils.m_264171_(p_78547_);
       DynamicOps<Tag> dynamicops = RegistryOps.m_255058_(NbtOps.f_128958_, p_78546_);
-      WorldGenSettings.m_245563_(dynamicops, this.f_244409_, p_78546_).resultOrPartial(Util.m_137489_("WorldGenSettings: ", f_78442_::error)).ifPresent((p_78574_) -> {
+      WorldGenSettings.m_246823_(dynamicops, this.f_244409_, new net.minecraft.world.level.levelgen.WorldDimensions(this.customDimensions != null ? this.customDimensions : p_78546_.m_175515_(net.minecraft.core.registries.Registries.f_256862_))).resultOrPartial(Util.m_137489_("WorldGenSettings: ", f_78442_::error)).ifPresent((p_78574_) -> { // CraftBukkit
          p_78547_.m_128365_("WorldGenSettings", p_78574_);
       });
       p_78547_.m_128405_("GameType", this.f_78443_.m_46929_().m_46392_());
@@ -203,6 +_,13 @@
          p_78547_.m_128362_("WanderingTraderId", this.f_78438_);
       }
 
+      p_78547_.m_128359_("forgeLifecycle", net.minecraftforge.common.ForgeHooks.encodeLifecycle(this.f_78443_.getLifecycle()));
+      p_78547_.m_128379_("confirmedExperimentalSettings", this.confirmedExperimentalWarning);
+
+      if (org.bukkit.Bukkit.getServer() != null) {
+         p_78547_.m_128359_("Bukkit.Version", org.bukkit.Bukkit.getName() + "/" + org.bukkit.Bukkit.getVersion() + "/" + org.bukkit.Bukkit.getBukkitVersion()); // CraftBukkit
+         world.getWorld().storeBukkitValues(p_78547_); // CraftBukkit - add pdc
+      }
    }
 
    private static ListTag m_277055_(Set<String> p_277880_) {
@@ -306,6 +_,20 @@
    }
 
    public void m_5557_(boolean p_78562_) {
+      // CraftBukkit start
+      if (this.f_78460_ == p_78562_) {
+         return;
+      }
+
+      org.bukkit.World world = org.bukkit.Bukkit.getWorld(m_5462_());
+      if (world != null) {
+         org.bukkit.event.weather.ThunderChangeEvent thunder = new org.bukkit.event.weather.ThunderChangeEvent(world, p_78562_);
+         org.bukkit.Bukkit.getServer().getPluginManager().callEvent(thunder);
+         if (thunder.isCancelled()) {
+            return;
+         }
+      }
+      // CraftBukkit end
       this.f_78460_ = p_78562_;
    }
 
@@ -322,6 +_,20 @@
    }
 
    public void m_5565_(boolean p_78576_) {
+      // CraftBukkit start
+      if (this.f_78458_ == p_78576_) {
+         return;
+      }
+
+      org.bukkit.World world = org.bukkit.Bukkit.getWorld(m_5462_());
+      if (world != null) {
+         org.bukkit.event.weather.WeatherChangeEvent weather = new org.bukkit.event.weather.WeatherChangeEvent(world, p_78576_);
+         org.bukkit.Bukkit.getServer().getPluginManager().callEvent(weather);
+         if (weather.isCancelled()) {
+            return;
+         }
+      }
+      // CraftBukkit end
       this.f_78458_ = p_78576_;
    }
 
@@ -375,6 +_,12 @@
 
    public void m_6166_(Difficulty p_78521_) {
       this.f_78443_ = this.f_78443_.m_46918_(p_78521_);
+      // CraftBukkit start
+      net.minecraft.network.protocol.game.ClientboundChangeDifficultyPacket packet = new net.minecraft.network.protocol.game.ClientboundChangeDifficultyPacket(this.m_5472_(), this.m_5474_());
+      for (net.minecraft.server.level.ServerPlayer player : world.m_6907_()) {
+         player.f_8906_.m_9829_(packet);
+      }
+      // CraftBukkit end
    }
 
    public boolean m_5474_() {
@@ -484,6 +_,23 @@
    public LevelSettings m_5926_() {
       return this.f_78443_.m_46935_();
    }
+
+   public boolean hasConfirmedExperimentalWarning() {
+      return this.confirmedExperimentalWarning;
+   }
+
+   public PrimaryLevelData withConfirmedWarning(boolean confirmedWarning) { // Builder-like to not patch ctor
+      this.confirmedExperimentalWarning = confirmedWarning;
+      return this;
+   }
+
+   // CraftBukkit start - Check if the name stored in NBT is the correct one
+   public void checkName(String name) {
+      if (!this.f_78443_.f_46902_.equals(name)) {
+         this.f_78443_.f_46902_ = name;
+      }
+   }
+   // CraftBukkit end
 
    /** @deprecated */
    @Deprecated
